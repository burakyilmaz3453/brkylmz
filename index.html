<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Burak Yılmaz | Dijital Kart</title>
<meta name="theme-color" content="#0b0f10">
<link rel="preload" href="./icons.svg" as="image" type="image/svg+xml">

<style>
  :root{
    --bg:#0b0f10; --panel:#0f1418; --text:#e9eef2; --muted:#b7c2ca;
    --radius:20px; --shadow:0 20px 60px rgba(0,0,0,.35);
    --stack-gap:64px;
    --line:#22303a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
    padding-bottom: calc(env(safe-area-inset-bottom, 0) + 16px);
  }

  /* sticky sarma */
  .sticky-wrap{ position:sticky; top:env(safe-area-inset-top,0); z-index:5 }
  .sticky-wrap::after{ content:""; display:block; height:var(--stack-gap) }

  /* kart */
  .card{
    width:min(720px,92vw); margin:0 auto;
    background:#0b1014; border-radius:var(--radius);
    overflow:hidden; box-shadow:var(--shadow);
  }
  .cover{ height:clamp(140px,32vw,180px); background:#111 url("banner.jpg") center/cover no-repeat; position:relative }
  .avatar{
    position:absolute; left:50%; bottom:-56px; transform:translateX(-50%);
    width:112px; height:112px; border-radius:50%;
    background:#fff url("brkylmz.jpg") center/cover no-repeat;
    box-shadow:0 0 0 4px #fff, 0 8px 24px rgba(0,0,0,.45);
    outline:6px solid #0f1418; cursor:zoom-in;
    transition:all .25s ease;
  }
  .inner{ background:var(--panel); padding:72px 22px 22px; text-align:center }
  .name{ margin:0 0 6px; font-weight:800; font-size:clamp(22px,5vw,28px) }
  .company{ color:var(--muted); font-size:14px }
  .title{ color:var(--muted); font-size:13px; margin-top:4px }

  .actions{
    display:grid; grid-template-columns:repeat(4,minmax(0,1fr));
    gap:12px; margin-top:22px;
  }
  .btn{
    display:flex; flex-direction:column; align-items:center; gap:8px;
    background:#11171c; border:1px solid rgba(255,255,255,.06);
    border-radius:14px; padding:14px 10px; color:#e9eef2; text-decoration:none;
  }
  .btn svg{ width:20px; height:20px; opacity:.9; fill: currentColor }
  .btn span{ font-size:12px; color:#d2dde6 }
  .btn:active{ transform:translateY(1px) }
  .btn.save{ background:#0f6d5d; border-color:rgba(255,255,255,.08) }
  .btn.save span{ color:#e9f7f3 }

  /* cp panel */
  .cp-panel{
    width:min(720px,92vw);
    margin: calc(-1 * var(--stack-gap)) auto 60px;
    background:#11171c; border:1px solid rgba(255,255,255,.06);
    border-radius:16px; box-shadow:0 14px 40px rgba(0,0,0,.35);
    position:relative; z-index:20; /* transform YOK */
  }
  .cp-grip{ display:flex; justify-content:center; padding:8px 0 4px }
  .cp-grip span{ width:58px; height:4px; border-radius:999px; background:rgba(255,255,255,.18) }

  .cp-list{ list-style:none; margin:8px; padding:0 }
  .cp-row{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; padding:12px; margin:8px 4px; border-radius:12px;
    background:#0f1418; border:1px solid rgba(255,255,255,.05);
  }
  .cp-left{ display:flex; align-items:center; gap:10px; min-width:0 }
  .cp-left svg{ width:18px; height:18px; opacity:.9; flex:0 0 auto; fill: currentColor }
  .cp-text{ color:#e9eef2; text-decoration:none; word-break:break-word }
  .cp-copy{
    display:inline-flex; align-items:center; justify-content:center;
    width:34px; height:34px; border-radius:10px; cursor:pointer;
    background:#0b1014; border:1px solid rgba(255,255,255,.12); color:#e9eef2;
  }

  /* alt bloklar */
  .cp-section{ padding:4px 12px 16px; border-top:1px solid var(--line); margin:10px 8px 0; border-radius:12px }
  .cp-title{ margin:12px 4px 10px; font-size:14px; font-weight:700; color:#d7e2ea }
  .cp-note{ color:#b9c6cf; font-size:13px; margin:6px 4px 0 }

  .map-card{ background:#0f1418; border:1px solid rgba(255,255,255,.05); border-radius:12px; overflow:hidden; margin:8px 4px 6px; }
  .map-embed{ width:100%; aspect-ratio:16/9; border:0; display:block }
  .map-actions{ display:flex; justify-content:flex-end; padding:10px; }
  .btn-dir{
    display:inline-flex; align-items:center; gap:8px; text-decoration:none;
    background:#0f6d5d; color:#e9f7f3; padding:8px 12px; border-radius:10px;
    font-size:13px; border:1px solid rgba(255,255,255,.12);
  }

  .social-list{ display:flex; gap:10px; padding:6px 4px 0 }
  .social-btn{
    display:inline-flex; align-items:center; justify-content:center;
    width:44px; height:44px; padding:0;
    border-radius:10px; background:#0a66c2; color:#fff; text-decoration:none;
    transition:background .2s, transform .15s;
  }
  .social-btn svg{ width:20px; height:20px; fill:#fff; display:block } /* LinkedIn fix */
  .social-btn:hover{ background:#004182; transform:translateY(-2px) }

  /* Şirket Bilgileri – kartlı liste */
  .kv2 { display: grid; gap: 10px; margin: 6px 4px 0; }
  .kv2-item{ display:flex; align-items:flex-start; gap:12px; background:#0f1418; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; }
  .kv2-ico{ width:36px; height:36px; border-radius:10px; background:#121a20; border:1px solid rgba(255,255,255,.06); display:inline-flex; align-items:center; justify-content:center; flex:0 0 auto; }
  .kv2-ico svg{ width:18px; height:18px; fill: currentColor }
  .kv2-body{ flex:1; min-width:0 }                 /* kopyalama butonu sağda hizalansın */
  .kv2-label{ color:#9fb0bb; font-size:12px; margin-bottom:2px }
  .kv2-value{ color:#e9eef2; font-size:14px; line-height:1.35; word-break:break-word; }
  .copy-mini{ width:32px; height:32px; border-radius:8px; margin-left:auto; background:#0b1014; border:1px solid rgba(255,255,255,.12); color:#e9eef2; }

  /* Avatar – yerinde büyütme */
  .avatar.expanded { width:200px; height:200px; bottom:-112px; z-index:40; cursor:zoom-out; }
  .av-close{
    position:absolute; left:calc(50% + 82px); bottom:-112px;
    width:32px; height:32px; border:0; border-radius:50%;
    background:#fff; color:#000; font-weight:700; cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.35); display:none;
  }
  .avatar.expanded + .av-close{ display:block; }

  /* === Basit QR MODAL === */
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
  .modal.open{ display:flex; }
  .modal .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.65); }
  .modal .box{ position:relative; z-index:1; background:#0f1418; padding:10px; border-radius:16px; }
  .modal img{ display:block; width:min(320px,92vw); height:auto; border-radius:12px }
  .modal .close{
    position:absolute; top:-10px; right:-10px;
    width:32px; height:32px; border-radius:50%;
    border:0; background:#fff; color:#000; font-weight:700; cursor:pointer;
    box-shadow:0 8px 24px rgba(0,0,0,.4);
  }

  @media (max-width: 560px){
    .kv{ grid-template-columns:1fr }
    .kv .k{ margin-top:8px }
  }
  @media (max-width: 420px){
    :root{ --stack-gap:140px }
    .cover{ height:140px }
    .avatar{ width:96px; height:96px; bottom:-48px }
    .inner{ padding:64px 16px 16px }
    .actions{ gap:10px }
    .btn{ padding:12px 8px }
  }
</style>
</head>
<body>

<!-- STICKY + KART -->
<div class="sticky-wrap">
  <section class="card" aria-label="Dijital Kart">
    <div class="cover">
      <div class="avatar" id="avatar" aria-label="Avatar"></div>
      <button id="avClose" class="av-close" aria-label="Kapat">×</button>
    </div>
    <div class="inner">
      <h1 class="name">Burak Yılmaz</h1>
      <div class="company">Osmanlı Menkul Değerler A.Ş.</div>
      <div class="title">BT System Yöneticisi</div>

      <nav class="actions" aria-label="Hızlı İşlemler">
        <a class="btn" href="tel:+905524915334" aria-label="Ara">
          <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-phone" xlink:href="./icons.svg#icon-phone"></use></svg>
          <span>Ara</span>
        </a>

        <a class="btn" href="mailto:buraky@osmanlimenkul.com.tr" aria-label="E-posta">
          <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-mail" xlink:href="./icons.svg#icon-mail"></use></svg>
          <span>E-mail</span>
        </a>

        <a class="btn" id="qrBtn" href="#" aria-label="QR Göster">
          <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-qr" xlink:href="./icons.svg#icon-qr"></use></svg>
          <span>QR</span>
        </a>

        <a class="btn save" href="https://raw.githubusercontent.com/burakyilmaz3453/brkylmz/main/BurakYilmazvCard.vcf" type="text/vcard" aria-label="Rehbere ekle">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a4 4 0 100-8 4 4 0 000 8zm-6 8a6 6 0 1112 0H6z"/><path d="M19 8h-2V6h-2V4h2V2h2v2h2v2h-2v2z"/></svg>
          <span>Kişilere Ekle</span>
        </a>
      </nav>
    </div>
  </section>
</div>

<!-- ALT PANEL -->
<section class="cp-panel" aria-label="İletişim">
  <div class="cp-grip"><span></span></div>
  <ul class="cp-list">
    <li class="cp-row" id="cpCellRow">
      <div class="cp-left">
        <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-mobile" xlink:href="./icons.svg#icon-mobile"></use></svg>
        <a id="cpCell" class="cp-text" href="#">—</a>
      </div>
      <button class="cp-copy" id="cpCopyCell" aria-label="Kopyala">⧉</button>
    </li>

    <li class="cp-row" id="cpWorkRow">
      <div class="cp-left">
        <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-phone" xlink:href="./icons.svg#icon-phone"></use></svg>
        <a id="cpWork" class="cp-text" href="#">—</a>
      </div>
      <button class="cp-copy" id="cpCopyWork" aria-label="Kopyala">⧉</button>
    </li>

    <li class="cp-row" id="cpMailRow">
      <div class="cp-left">
        <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-mail" xlink:href="./icons.svg#icon-mail"></use></svg>
        <a id="cpMail" class="cp-text" href="#">—</a>
      </div>
      <button class="cp-copy" id="cpCopyMail" aria-label="Kopyala">⧉</button>
    </li>

    <li class="cp-row" id="cpWebRow">
      <div class="cp-left">
        <svg viewBox="0 0 24 24"><use href="./icons.svg#icon-web" xlink:href="./icons.svg#icon-web"></use></svg>
        <a id="cpWeb" class="cp-text" href="#" target="_blank" rel="noopener">—</a>
      </div>
      <button class="cp-copy" id="cpCopyWeb" aria-label="Kopyala">⧉</button>
    </li>
  </ul>

  <!-- Address -->
  <div class="cp-section" id="secAddress" hidden>
    <div class="cp-title">Adres Bilgileri</div>
    <div class="map-card">
      <iframe id="mapFrame" class="map-embed" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="map-actions">
        <a id="btnDirections" class="btn-dir" target="_blank" rel="noopener">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l10 10-10 10L2 12 12 2zm1 7h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"/></svg>
          Get Directions
        </a>
      </div>
    </div>
    <div class="cp-note" id="addrText"></div>
  </div>

  <!-- Sosyal -->
  <div class="cp-section" id="secSocial" hidden>
    <div class="cp-title">Sosyal Medya</div>
    <div class="social-list">
      <a id="linkedinId" class="social-btn" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-hidden="true">
          <path d="M100.28 448H7.4V148.9h92.88zm-46.44-341C24 107 0 83 0 53.6 0 24.3 24 0 53.8 0 83.6 0 107 24.3 107 53.6c0 29.4-23.4 53.4-53.16 53.4zM447.9 448h-92.4V304.1c0-34.3-12.3-57.7-43.1-57.7-23.5 0-37.5 15.8-43.6 31.1-2.2 5.4-2.8 12.9-2.8 20.4V448h-92.4s1.2-272.1 0-299.1h92.4v42.4c12.3-19 34.4-46.1 83.7-46.1 61.2 0 107.2 39.9 107.2 125.4V448z"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Şirket Bilgileri -->
  <div class="cp-section" id="secCompany" hidden>
    <div class="cp-title">Şirket Bilgileri</div>
    <div class="kv2">
      <div class="kv2-item" id="rowName">
        <div class="kv2-ico"><svg viewBox="0 0 24 24"><use href="./icons.svg#icon-company" xlink:href="./icons.svg#icon-company"></use></svg></div>
        <div class="kv2-body"><div class="kv2-label">Şirket Adı</div><div class="kv2-value" id="ciName"><span>—</span></div></div>
        <button class="copy-mini" data-copy="">⧉</button>
      </div>

      <div class="kv2-item" id="rowAddr">
        <div class="kv2-ico"><svg viewBox="0 0 24 24"><use href="./icons.svg#icon-location" xlink:href="./icons.svg#icon-location"></use></svg></div>
        <div class="kv2-body"><div class="kv2-label">Şirket Adresi</div><div class="kv2-value" id="ciAddr"><span>—</span></div></div>
        <button class="copy-mini" data-copy="">⧉</button>
      </div>

      <div class="kv2-item" id="rowTaxOffice" hidden>
        <div class="kv2-ico"><svg viewBox="0 0 24 24"><use href="./icons.svg#icon-tax-office" xlink:href="./icons.svg#icon-tax-office"></use></svg></div>
        <div class="kv2-body"><div class="kv2-label">Vergi Dairesi</div><div class="kv2-value" id="ciTaxOffice"><span>—</span></div></div>
        <button class="copy-mini" data-copy="">⧉</button>
      </div>

      <div class="kv2-item" id="rowTaxNo" hidden>
        <div class="kv2-ico"><svg viewBox="0 0 24 24"><use href="./icons.svg#icon-tax-no" xlink:href="./icons.svg#icon-tax-no"></use></svg></div>
        <div class="kv2-body"><div class="kv2-label">Vergi No</div><div class="kv2-value" id="ciTaxNo"><span>—</span></div></div>
        <button class="copy-mini" data-copy="">⧉</button>
      </div>
    </div>
  </div>
</section>

<!-- QR MODAL -->
<div class="modal" id="qrModal" aria-hidden="true">
  <div class="overlay"></div>
  <div class="box">
    <button class="close" aria-label="Kapat">×</button>
    <img src="./qr.svg" alt="QR Kod">
  </div>
</div>

<script>
async function injectSprite() {
  const SPRITE_URL = './icons.svg?v=8';
  try {
    const txt = await fetch(SPRITE_URL, { cache: 'no-store' }).then(r => r.text());
    const wrap = document.createElement('div');
    wrap.style.display = 'none';
    wrap.innerHTML = txt;
    document.body.prepend(wrap);

    // <use href="/icons.svg#..."> -> <use href="#...">
    document.querySelectorAll('use').forEach(u => {
      const href = u.getAttribute('href') || u.getAttribute('xlink:href') || '';
      const id = href.split('#')[1];
      if (id) {
        u.setAttribute('href', `#${id}`);
        u.removeAttribute('xlink:href');
      }
    });
  } catch (e) {
    console.warn('icons.svg yüklenemedi', e);
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  await injectSprite();  // ← sprite içe alındıktan sonra devam et
  // ... mevcut kodların burada ...
});
</script>


<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ====== VCF + Kopyalama ====== */
  const saveLink=document.querySelector('.btn.save');
  const href=saveLink ? saveLink.getAttribute('href') : '';
  const candidates=[href,'./BurakYilmazvCard.vcf','https://raw.githubusercontent.com/burakyilmaz3453/brkylmz/main/BurakYilmazvCard.vcf','https://burakyilmaz3453.github.io/brkylmz/BurakYilmazvCard.vcf'].filter(Boolean);
  const unfold=s=>s.replace(/\r?\n[ \t]/g,'');
  const parse=ln=>{ const m=ln.match(/^([A-Z-]+)(;[^:]+)?:([\s\S]*)$/i); return m?{key:m[1].toUpperCase(),params:(m[2]||'').toLowerCase(),val:m[3].trim()}:null };
  const hasType=(p,t)=>new RegExp(`(?:^|;|,)type=[^:]*\\b${t}\\b`,'i').test(p);
  const telHref=v=>'tel:'+(v||'').replace(/[^+\d]/g,'');
  const mailHref=v=>'mailto:'+(v||'');
  const urlNorm=v=>(v||'').startsWith('http')?v:('https://'+(v||''));
  function formatADR(v){const parts=v.split(';');const street=parts[2]||'',city=parts[3]||'',region=parts[4]||'',postal=parts[5]||'',country=parts[6]||'';return[street,postal&&(postal+' '+city)||city,region,country].filter(Boolean).join(' / ');}
  async function loadVCF(){for(const url of candidates){try{const res=await fetch(url,{cache:'no-store'});if(res.ok){fill(await res.text());return;}}catch{} } console.warn('VCF bulunamadı/okunamadı.');}
  function fill(raw){
    const lines=unfold(raw).split(/\r?\n/).map(parse).filter(Boolean);
    const d={cell:null,work:null,email:null,url:null,org:null,addrLabel:null,addrAdr:null,linkedin:null,taxOffice:null,taxNumber:null};const items={};
    for(const it of lines){
      const k=it.key;
      if(k==='TEL'){ if(hasType(it.params,'cell')||hasType(it.params,'mobile')) d.cell??=it.val; else if(hasType(it.params,'work')) d.work??=it.val; else if(!d.cell) d.cell=it.val; }
      if(k==='EMAIL'){ if(hasType(it.params,'work')) d.email??=it.val; else if(!d.email) d.email=it.val; }
      if(k==='URL'){ d.url??=it.val; }
      if(k==='ORG') d.org=it.val;
      if(k==='LABEL'&&hasType(it.params,'work')) d.addrLabel=it.val.replace(/\\n/g,' ');
      if(k==='ADR'  &&hasType(it.params,'work')) d.addrAdr=formatADR(it.val);
      const itm=it.key.match(/^ITEM\d+\.([A-Z-]+)$/i);
      if(itm){ const id=it.key.split('.')[0].toLowerCase(); items[id]??={}; items[id][itm[1].toUpperCase()]=it.val; }
      if(k==='X-SOCIALPROFILE' && /linkedin/i.test(it.params+it.val)) d.linkedin??=it.val;
      if(k==='X-LINKEDIN') d.linkedin??=it.val;
      if(/^X-.*TAX.*OFFICE/i.test(k)||/VERGI.*DAIRESI/i.test(k)) d.taxOffice??=it.val;
      if(/^X-.*TAX.*NUMBER/i.test(k)||/VERGI.*NO/i.test(k)) d.taxNumber??=it.val;
      if(k==='NOTE'){ const t=it.val;
        const m1=t.match(/Tax Office\s*:\s*(.+)/i)||t.match(/Vergi Dairesi\s*:\s*(.+)/i);
        const m2=t.match(/Tax Number\s*:\s*([\d\.]+)/i)||t.match(/Vergi No\s*:\s*([\d\.]+)/i);
        if(m1) d.taxOffice??=m1[1].trim();
        if(m2) d.taxNumber??=m2[1].trim();
      }
    }
    for(const id in items){ const obj=items[id]; if(obj.URL && /linkedin/i.test((obj['X-ABLABEL']||'')+obj.URL)) d.linkedin??=obj.URL; }

    if(d.cell){ const a=document.getElementById('cpCell'); a.textContent=d.cell; a.href=telHref(d.cell); document.getElementById('cpCopyCell').dataset.copy=d.cell; } else document.getElementById('cpCellRow').style.display='none';
    if(d.work){ const a=document.getElementById('cpWork'); a.textContent=d.work; a.href=telHref(d.work); document.getElementById('cpCopyWork').dataset.copy=d.work; } else document.getElementById('cpWorkRow').style.display='none';
    if(d.email){ const a=document.getElementById('cpMail'); a.textContent=d.email; a.href=mailHref(d.email); document.getElementById('cpCopyMail').dataset.copy=d.email; } else document.getElementById('cpMailRow').style.display='none';
    if(d.url){ const a=document.getElementById('cpWeb'); a.textContent=d.url; a.href=urlNorm(d.url); document.getElementById('cpCopyWeb').dataset.copy=d.url; } else document.getElementById('cpWebRow').style.display='none';

    const address=d.addrLabel||d.addrAdr||'';
    if(address){ const sec=document.getElementById('secAddress'); sec.hidden=false; document.getElementById('addrText').textContent=address;
      const q=encodeURIComponent(address);
      document.getElementById('mapFrame').src=`https://www.google.com/maps?q=${q}&output=embed`;
      document.getElementById('btnDirections').href=`https://www.google.com/maps/dir/?api=1&destination=${q}`; }

    if(d.linkedin){ const s=document.getElementById('secSocial'); s.hidden=false; const a=document.getElementById('linkedinId'); a.hidden=false; a.href=urlNorm(d.linkedin); }

    if(d.org||address||d.taxOffice||d.taxNumber){
      const sec=document.getElementById('secCompany'); sec.hidden=false;
      if(d.org){ const el=document.getElementById('ciName'); el.querySelector('span').textContent=d.org; el.parentElement.nextElementSibling.dataset.copy=d.org; }
      if(address){ const el=document.getElementById('ciAddr'); el.querySelector('span').textContent=address; el.parentElement.nextElementSibling.dataset.copy=address; }
      if(d.taxOffice){ document.getElementById('rowTaxOffice').hidden=false; const el=document.getElementById('ciTaxOffice'); el.querySelector('span').textContent=d.taxOffice; el.parentElement.nextElementSibling.dataset.copy=d.taxOffice; }
      if(d.taxNumber){ document.getElementById('rowTaxNo').hidden=false; const el=document.getElementById('ciTaxNo'); el.querySelector('span').textContent=d.taxNumber; el.parentElement.nextElementSibling.dataset.copy=d.taxNumber; }
    }
  }
  function wireCopies(){ document.querySelectorAll('.copy-mini, .cp-copy').forEach(btn=>{ const orig=btn.textContent; btn.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(btn.dataset.copy||''); btn.textContent='✓'; setTimeout(()=>btn.textContent=orig,900); }catch{ alert('Kopyalanamadı'); } }); }); }
  loadVCF().then(wireCopies);

  /* Avatar yerinde büyüt/küçült + dışa tıklayınca/ESC kapanış */
  const av=document.getElementById('avatar');
  const avClose=document.getElementById('avClose');
  if(av && avClose){
    av.addEventListener('click', ()=>{ av.classList.add('expanded'); avClose.style.display='block'; });
    avClose.addEventListener('click', e=>{ e.stopPropagation(); av.classList.remove('expanded'); avClose.style.display='none'; });
    document.addEventListener('click', (e)=>{
      if(av.classList.contains('expanded') && !av.contains(e.target) && e.target!==avClose){
        av.classList.remove('expanded'); avClose.style.display='none';
      }
    });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && av.classList.contains('expanded')){ av.classList.remove('expanded'); avClose.style.display='none'; }});
  }

  /* === QR modal (basit) === */
  const qrBtn  = document.getElementById('qrBtn');
  const qrModal= document.getElementById('qrModal');
  const qrOv   = qrModal.querySelector('.overlay');
  const qrX    = qrModal.querySelector('.close');

  function openQR(e){ if(e) e.preventDefault(); qrModal.classList.add('open'); }
  function closeQR(){ qrModal.classList.remove('open'); }

  if(qrBtn && qrModal){
    qrBtn.addEventListener('click', openQR);
    qrOv.addEventListener('click', closeQR);
    qrX.addEventListener('click', closeQR);
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeQR(); });
  }
});

document.addEventListener('DOMContentLoaded', () => {
  // ... senin mevcut kodların ...

  // === Kişilere Ekle: mobilde AÇ, masaüstünde İNDİR ===
  const saveBtn = document.getElementById('saveBtn');
  if (saveBtn) {
    const vcfURL = saveBtn.getAttribute('href');
    const fileName = saveBtn.dataset.filename || 'contact.vcf';

    const isMobile = (navigator.userAgentData && 'mobile' in navigator.userAgentData)
      ? navigator.userAgentData.mobile
      : /Android|iPhone|iPad|iPod|IEMobile|Windows Phone|Mobile/i.test(navigator.userAgent);

    async function downloadVCF(url, name){
      try {
        const resp = await fetch(url, { mode: 'cors', cache: 'no-store' });
        const blob = await resp.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = name;
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(a.href);
        a.remove();
      } catch (err) {
        // bir şey olursa normal aç (fallback)
        window.location.href = url;
      }
    }

    saveBtn.addEventListener('click', (e) => {
      if (!isMobile) {                 // Masaüstü: indir
        e.preventDefault();
        downloadVCF(vcfURL, fileName);
      }                                // Mobil: tarayıcı açıp Rehbere Ekle akışını başlatır
    });
  }
});
</script>

</body>
</html>

